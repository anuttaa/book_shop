<!DOCTYPE html>
<html class="light" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Admin Panel - Book Management</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#007BFF",
                        "primary-content": "#FFFFFF",
                        "secondary": "#28A745",
                        "secondary-content": "#FFFFFF",
                        "destructive": "#DC3545",
                        "destructive-content": "#FFFFFF",
                        "background-light": "#F8F9FA",
                        "background-dark": "#101622",
                        "content-light": "#FFFFFF",
                        "content-dark": "#182131",
                        "text-light": "#212529",
                        "text-dark": "#E0E0E0",
                        "subtle-light": "#616f89",
                        "subtle-dark": "#94a3b8",
                        "border-light": "#DEE2E6",
                        "border-dark": "#2d3748",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "0.75rem",
                        "xl": "1rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24
        }
    </style>
</head>
<body class="font-display bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark">
<div class="relative flex min-h-screen w-full">
    <!-- SideNavBar (остается без изменений) -->
    <aside class="flex h-screen w-64 flex-col border-r border-border-light dark:border-border-dark bg-content-light dark:bg-content-dark">
        <div class="flex h-full flex-col justify-between p-4">
            <div class="flex flex-col gap-4">
                <div class="flex items-center gap-3 p-2">
                    <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 bg-gradient-to-br from-primary to-blue-600 flex items-center justify-center text-white font-bold">
                        A
                    </div>
                    <div class="flex flex-col">
                        <h1 class="text-text-light dark:text-text-dark text-base font-medium leading-normal">Admin</h1>
                        <p class="text-subtle-light dark:text-subtle-dark text-sm font-normal leading-normal">admin@bookstore.com</p>
                    </div>
                </div>
                <!-- Обновите навигационные ссылки в aside -->
                <nav class="flex flex-col gap-2">
                    <a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT bg-primary/10 text-primary"
                       href="#" data-page="book-management">
                        <span class="material-symbols-outlined text-2xl" style="font-variation-settings: 'FILL' 1;">menu_book</span>
                        <p class="text-sm font-medium">Book Management</p>
                    </a>
                    <a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT text-subtle-light dark:text-subtle-dark hover:bg-background-light dark:hover:bg-background-dark"
                       href="#" data-page="orders">
                        <span class="material-symbols-outlined text-2xl">shopping_cart</span>
                        <p class="text-sm font-medium">Orders</p>
                    </a>
                    <a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT text-subtle-light dark:text-subtle-dark hover:bg-background-light dark:hover:bg-background-dark"
                       href="#" data-page="customers">
                        <span class="material-symbols-outlined text-2xl">group</span>
                        <p class="text-sm font-medium">Customers</p>
                    </a>
                    <a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT text-subtle-light dark:text-subtle-dark hover:bg-background-light dark:hover:bg-background-dark"
                       href="#" data-page="analytics">
                        <span class="material-symbols-outlined text-2xl">bar_chart</span>
                        <p class="text-sm font-medium">Analytics</p>
                    </a>
                </nav>
            </div>
            <div class="flex flex-col gap-1">
                <a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT text-subtle-light dark:text-subtle-dark hover:bg-background-light dark:hover:bg-background-dark" href="#">
                    <span class="material-symbols-outlined text-2xl">settings</span>
                    <p class="text-sm font-medium">Settings</p>
                </a>
                <a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT text-subtle-light dark:text-subtle-dark hover:bg-background-light dark:hover:bg-background-dark" href="#" onclick="logout()">
                    <span class="material-symbols-outlined text-2xl">logout</span>
                    <p class="text-sm font-medium">Log out</p>
                </a>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex-col overflow-y-auto">
        <div class="p-8">
            <!-- PageHeading -->
            <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                <h1 class="text-text-light dark:text-text-dark text-3xl font-bold leading-tight tracking-tight">Book Management</h1>
                <button class="flex min-w-[84px] cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-DEFAULT h-10 px-4 bg-secondary text-secondary-content text-sm font-bold leading-normal tracking-[0.015em] hover:opacity-90" onclick="openAddBookModal()">
                    <span class="material-symbols-outlined">add</span>
                    <span class="truncate">Add New Book</span>
                </button>
            </div>

            <div class="bg-content-light dark:bg-content-dark rounded-lg shadow-sm">
                <!-- SearchBar & Chips - ПЕРЕДЕЛАННАЯ СЕКЦИЯ -->
                <div class="p-4 border-b border-border-light dark:border-border-dark">
                    <div class="flex flex-col gap-4">
                        <!-- Поиск -->
                        <div class="flex-1">
                            <label class="flex flex-col min-w-40 h-10 w-full">
                                <div class="flex w-full flex-1 items-stretch rounded-DEFAULT h-full">
                                    <div class="text-subtle-light dark:text-subtle-dark flex border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark items-center justify-center pl-3 rounded-l-DEFAULT border-r-0">
                                        <span class="material-symbols-outlined">search</span>
                                    </div>
                                    <input id="searchInput" class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-DEFAULT text-text-light dark:text-text-dark focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark h-full placeholder:text-subtle-light dark:placeholder:text-subtle-dark px-4 rounded-l-none border-l-0 pl-2 text-base font-normal leading-normal" placeholder="Search by title, author, or genre..." value=""/>
                                </div>
                            </label>
                        </div>

                        <!-- Фильтры - ПЕРЕДЕЛАННАЯ СТРУКТУРА -->
                        <div class="filters-sticky bg-content-light dark:bg-content-dark">
                            <div class="flex flex-wrap items-center gap-3">
                                <!-- Genre Filter -->
                                <div class="relative">
                                    <button class="filter-toggle flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark pl-3 pr-3 text-subtle-light dark:text-subtle-dark hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                                            data-target="genres">
                                        <span class="material-symbols-outlined text-base">filter_list</span>
                                        <p class="text-sm font-medium">Genre</p>
                                        <span class="material-symbols-outlined text-base expand-icon">expand_more</span>
                                    </button>
                                    <div id="genres" class="filter-dropdown hidden absolute mt-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-3 shadow-lg w-48">
                                        <!-- Genres will be loaded dynamically -->
                                    </div>
                                </div>

                                <!-- Author Filter -->
                                <div class="relative">
                                    <button class="filter-toggle flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark pl-3 pr-3 text-subtle-light dark:text-subtle-dark hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                                            data-target="authors">
                                        <span class="material-symbols-outlined text-base">filter_list</span>
                                        <p class="text-sm font-medium">Author</p>
                                        <span class="material-symbols-outlined text-base expand-icon">expand_more</span>
                                    </button>
                                    <div id="authors" class="filter-dropdown hidden absolute mt-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-3 shadow-lg w-48">
                                        <!-- Authors will be loaded dynamically -->
                                    </div>
                                </div>

                                <!-- Format Filter -->
                                <div class="relative">
                                    <button class="filter-toggle flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark pl-3 pr-3 text-subtle-light dark:text-subtle-dark hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                                            data-target="formats">
                                        <span class="material-symbols-outlined text-base">filter_list</span>
                                        <p class="text-sm font-medium">Format</p>
                                        <span class="material-symbols-outlined text-base expand-icon">expand_more</span>
                                    </button>
                                    <div id="formats" class="filter-dropdown hidden absolute mt-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-3 shadow-lg w-48">
                                        <!-- Formats will be loaded dynamically -->
                                    </div>
                                </div>

                                <!-- Price Filter -->
                                <div class="relative">
                                    <button class="filter-toggle flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark pl-3 pr-3 text-subtle-light dark:text-subtle-dark hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                                            data-target="price">
                                        <span class="material-symbols-outlined text-base">filter_list</span>
                                        <p class="text-sm font-medium">Price</p>
                                        <span class="material-symbols-outlined text-base expand-icon">expand_more</span>
                                    </button>
                                    <div id="price" class="filter-dropdown hidden absolute mt-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 shadow-lg w-64">
                                        <div class="mb-2">
                                            <span id="price-value" class="text-sm font-medium text-text-light dark:text-text-dark">$0 - $100</span>
                                        </div>
                                        <input type="range" id="price-slider" min="0" max="100" value="100"
                                               class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">
                                    </div>
                                </div>

                                <!-- Reset Filters Button -->
                                <button class="flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                                        onclick="resetFilters()">
                                    <span class="material-symbols-outlined text-subtle-light dark:text-subtle-dark text-xl">restart_alt</span>
                                    <p class="text-subtle-light dark:text-subtle-dark text-sm font-medium">Reset Filters</p>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Table и остальной контент без изменений -->
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-subtle-light dark:text-subtle-dark uppercase bg-background-light dark:bg-background-dark">
                        <tr>
                            <th class="p-4" scope="col">
                                <input id="selectAll" class="h-4 w-4 rounded border-border-light dark:border-border-dark bg-transparent text-primary checked:bg-primary checked:border-primary focus:ring-2 focus:ring-offset-0 focus:ring-primary/50" type="checkbox"/>
                            </th>
                            <th class="px-4 py-3" scope="col">Cover</th>
                            <th class="px-4 py-3 min-w-64" scope="col">Title</th>
                            <th class="px-4 py-3 min-w-40" scope="col">Author</th>
                            <th class="px-4 py-3" scope="col">Genre</th>
                            <th class="px-4 py-3" scope="col">Type</th>
                            <th class="px-4 py-3" scope="col">Price</th>
                            <th class="px-4 py-3" scope="col">In Cart</th>
                            <th class="px-4 py-3" scope="col">Status</th>
                            <th class="px-4 py-3 text-right" scope="col">Actions</th>
                        </tr>
                        </thead>
                        <tbody id="booksTableBody">
                        <!-- Books will be loaded dynamically -->
                        </tbody>
                    </table>
                </div>

                <!-- Loading State -->
                <div id="loadingState" class="p-8 text-center">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
                    <p class="mt-2 text-subtle-light dark:text-subtle-dark">Loading books...</p>
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="hidden p-8 text-center">
                    <span class="material-symbols-outlined text-6xl text-subtle-light dark:text-subtle-dark mb-4">menu_book</span>
                    <h3 class="text-lg font-medium text-text-light dark:text-text-dark mb-2">No books found</h3>
                    <p class="text-subtle-light dark:text-subtle-dark mb-4">Get started by adding your first book to the catalog.</p>
                    <button class="flex min-w-[84px] cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-DEFAULT h-10 px-4 bg-secondary text-secondary-content text-sm font-bold leading-normal tracking-[0.015em] hover:opacity-90" onclick="openAddBookModal()">
                        <span class="material-symbols-outlined">add</span>
                        <span class="truncate">Add New Book</span>
                    </button>
                </div>

                <!-- Pagination -->
                <div class="hidden flex items-center justify-between p-4 border-t border-border-light dark:border-border-dark" id="paginationContainer">
                    <span class="text-sm text-subtle-light dark:text-subtle-dark">Showing <span class="font-semibold text-text-light dark:text-text-dark" id="showingRange">1-0</span> of <span class="font-semibold text-text-light dark:text-text-dark" id="totalBooks">0</span></span>
                    <div class="flex items-center gap-2">
                        <button class="flex items-center justify-center px-3 h-8 text-sm font-medium border rounded-DEFAULT bg-content-light dark:bg-content-dark border-border-light dark:border-border-dark text-subtle-light dark:text-subtle-dark hover:bg-background-light dark:hover:bg-background-dark" onclick="previousPage()">Previous</button>
                        <button class="flex items-center justify-center px-3 h-8 text-sm font-medium border rounded-DEFAULT bg-content-light dark:bg-content-dark border-border-light dark:border-border-dark text-subtle-light dark:text-subtle-dark hover:bg-background-light dark:hover:bg-background-dark" onclick="nextPage()">Next</button>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Add Book Modal -->
<div id="addBookModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-content-light dark:bg-content-dark rounded-lg p-6 w-full max-w-2xl mx-4">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold text-text-light dark:text-text-dark">Add New Book</h3>
            <button onclick="closeAddBookModal()" class="text-subtle-light dark:text-subtle-dark hover:text-text-light dark:hover:text-text-dark">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        <form id="addBookForm" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-text-light dark:text-text-dark mb-1">Cover Image URL</label>
                    <input type="url" name="imageUrl" class="w-full rounded-DEFAULT border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark px-3 py-2 text-text-light dark:text-text-dark"
                           placeholder="https://example.com/book-cover.jpg">
                    <p class="text-xs text-subtle-light dark:text-subtle-dark mt-1">Optional: Provide a URL for the book cover image</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-text-light dark:text-text-dark mb-1">Title *</label>
                    <input type="text" name="title" required class="w-full rounded-DEFAULT border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark px-3 py-2 text-text-light dark:text-text-dark">
                </div>

                <div>
                    <label class="block text-sm font-medium text-text-light dark:text-text-dark mb-1">Author *</label>
                    <input type="text" name="author" required class="w-full rounded-DEFAULT border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark px-3 py-2 text-text-light dark:text-text-dark">
                </div>

                <div>
                    <label class="block text-sm font-medium text-text-light dark:text-text-dark mb-1">Genre *</label>
                    <input type="text" name="genre" required class="w-full rounded-DEFAULT border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark px-3 py-2 text-text-light dark:text-text-dark">
                </div>

                <div>
                    <label class="block text-sm font-medium text-text-light dark:text-text-dark mb-1">Price *</label>
                    <input type="number" step="0.01" min="0" name="price" required class="w-full rounded-DEFAULT border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark px-3 py-2 text-text-light dark:text-text-dark">
                </div>

                <div>
                    <label class="block text-sm font-medium text-text-light dark:text-text-dark mb-1">Type *</label>
                    <select name="type" required class="w-full rounded-DEFAULT border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark px-3 py-2 text-text-light dark:text-text-dark">
                        <option value="physical">Physical</option>
                        <option value="electronic">Electronic</option>
                    </select>
                </div>

                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-text-light dark:text-text-dark mb-1">Description</label>
                    <textarea name="description" rows="3" class="w-full rounded-DEFAULT border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark px-3 py-2 text-text-light dark:text-text-dark"
                              placeholder="Enter book description..."></textarea>
                </div>
            </div>

            <div class="flex justify-end gap-3 pt-4 border-t border-border-light dark:border-border-dark">
                <button type="button" onclick="closeAddBookModal()" class="px-4 py-2 text-subtle-light dark:text-subtle-dark hover:text-text-light dark:hover:text-text-dark transition-colors">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-primary text-primary-content rounded-DEFAULT hover:opacity-90 transition-opacity">Add Book</button>
            </div>
        </form>
    </div>
</div>

<script src="/js/api.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/admin.js"></script>
<script src="/js/admin-navigation.js"></script>
<script src="/js/admin-books.js"></script>
<script src="/js/admin-orders.js"></script>
<script src="/js/admin-customers.js"></script>
<script src="/js/admin-analytics.js"></script>
</body>
</html>