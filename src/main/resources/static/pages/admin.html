<!DOCTYPE html>
<html class="light" lang="ru">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Админ-панель — Управление книгами</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <link rel="stylesheet" href="/css/main.css"/>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24
        }
    </style>
</head>
<body class="font-display bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark">
<div class="relative flex min-h-screen w-full">
    <!-- SideNavBar (остается без изменений) -->
    <aside class="flex h-screen w-64 flex-col border-r border-border-light dark:border-border-dark bg-content-light dark:bg-content-dark">
        <div class="flex h-full flex-col justify-between p-4">
            <div class="flex flex-col gap-4">
                <div class="flex items-center gap-3 p-2">
                    <div class="avatar"><span id="adminAvatarLetter">A</span></div>
                    <div class="flex flex-col">
                        <h1 id="adminName" class="text-text-light dark:text-text-dark text-base font-medium leading-normal">Администратор</h1>
                        <p id="adminEmail" class="text-subtle-light dark:text-subtle-dark text-sm font-normal leading-normal"></p>
                    </div>
                </div>
                <!-- Обновите навигационные ссылки в aside -->
                <nav class="flex flex-col gap-2">
                    <a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT bg-primary/10 text-primary"
                       href="#" data-page="book-management">
                        <span class="material-symbols-outlined text-2xl" style="font-variation-settings: 'FILL' 1;">menu_book</span>
                        <p class="text-sm font-medium">Управление книгами</p>
                    </a>
                    <a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT text-subtle-light dark:text-subtle-dark hover:bg-background-light dark:hover:bg-background-dark"
                       href="#" data-page="orders">
                        <span class="material-symbols-outlined text-2xl">shopping_cart</span>
                        <p class="text-sm font-medium">Заказы</p>
                    </a>
                    <a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT text-subtle-light dark:text-subtle-dark hover:bg-background-light dark:hover:bg-background-dark"
                       href="#" data-page="customers">
                        <span class="material-symbols-outlined text-2xl">group</span>
                        <p class="text-sm font-medium">Пользователи</p>
                    </a>
                    <a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT text-subtle-light dark:text-subtle-dark hover:bg-background-light dark:hover:bg-background-dark"
                       href="#" data-page="newsletter">
                        <span class="material-symbols-outlined text-2xl">mail</span>
                        <p class="text-sm font-medium">Рассылка</p>
                    </a>
                    <a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT text-subtle-light dark:text-subtle-dark hover:bg-background-light dark:hover:bg-background-dark"
                       href="#" data-page="analytics">
                        <span class="material-symbols-outlined text-2xl">bar_chart</span>
                        <p class="text-sm font-medium">Аналитика</p>
                    </a>
                </nav>
            </div>
            <div class="flex flex-col gap-1">
                <a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT text-subtle-light dark:text-subtle-dark hover:bg-background-light dark:hover:bg-background-dark" href="#">
                    <span class="material-symbols-outlined text-2xl">settings</span>
                    <p class="text-sm font-medium">Настройки</p>
                </a>
                <a class="flex items-center gap-3 px-3 py-2 rounded-DEFAULT text-subtle-light dark:text-subtle-dark hover:bg-background-light dark:hover:bg-background-dark" href="#" onclick="logout()">
                    <span class="material-symbols-outlined text-2xl">logout</span>
                    <p class="text-sm font-medium">Выйти</p>
                </a>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex-col overflow-y-auto">
        <div class="p-8">
            <!-- PageHeading -->
            <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                <h1 class="text-text-light dark:text-text-dark text-3xl font-bold leading-tight tracking-tight">Управление книгами</h1>
                <button class="flex min-w-[84px] cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-DEFAULT h-10 px-4 bg-secondary text-secondary-content text-sm font-bold leading-normal tracking-[0.015em] hover:opacity-90" onclick="openAddBookModal()">
                    <span class="material-symbols-outlined">add</span>
                    <span class="truncate">Добавить книгу</span>
                </button>
            </div>

            <div class="bg-content-light dark:bg-content-dark rounded-lg shadow-sm">
                <!-- SearchBar & Chips - ПЕРЕДЕЛАННАЯ СЕКЦИЯ -->
                <div class="p-4 border-b border-border-light dark:border-border-dark">
                    <div class="flex flex-col gap-4">
                        <!-- Поиск -->
                        <div class="flex-1">
                            <label class="flex flex-col min-w-40 h-10 w-full">
                                <div class="flex w-full flex-1 items-stretch rounded-DEFAULT h-full">
                                    <div class="text-subtle-light dark:text-subtle-dark flex border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark items-center justify-center pl-3 rounded-l-DEFAULT border-r-0">
                                        <span class="material-symbols-outlined">search</span>
                                    </div>
                                    <input id="searchInput" class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-DEFAULT text-text-light dark:text-text-dark focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark h-full placeholder:text-subtle-light dark:placeholder:text-subtle-dark px-4 rounded-l-none border-l-0 pl-2 text-base font-normal leading-normal" placeholder="Поиск по названию, автору или жанру..." value=""/>
                                </div>
                            </label>
                        </div>

                        <!-- Фильтры - ПЕРЕДЕЛАННАЯ СТРУКТУРА -->
                        <div class="filters-sticky bg-content-light dark:bg-content-dark">
                            <div class="flex flex-wrap items-center gap-3">
                                <!-- Genre Filter -->
                                <div class="relative">
                                    <button class="filter-toggle flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark pl-3 pr-3 text-subtle-light dark:text-subtle-dark hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                                            data-target="genres">
                                        <span class="material-symbols-outlined text-base">filter_list</span>
                                        <p class="text-sm font-medium">Жанр</p>
                                        <span class="material-symbols-outlined text-base expand-icon">expand_more</span>
                                    </button>
                                    <div id="genres" class="filter-dropdown hidden absolute mt-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-3 shadow-lg w-48">
                                        <!-- Genres will be loaded dynamically -->
                                    </div>
                                </div>

                                <!-- Author Filter -->
                                <div class="relative">
                                    <button class="filter-toggle flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark pl-3 pr-3 text-subtle-light dark:text-subtle-dark hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                                            data-target="authors">
                                        <span class="material-symbols-outlined text-base">filter_list</span>
                                        <p class="text-sm font-medium">Автор</p>
                                        <span class="material-symbols-outlined text-base expand-icon">expand_more</span>
                                    </button>
                                    <div id="authors" class="filter-dropdown hidden absolute mt-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-3 shadow-lg w-48">
                                        <!-- Authors will be loaded dynamically -->
                                    </div>
                                </div>

                                <!-- Format Filter -->
                                <div class="relative">
                                    <button class="filter-toggle flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark pl-3 pr-3 text-subtle-light dark:text-subtle-dark hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                                            data-target="formats">
                                        <span class="material-symbols-outlined text-base">filter_list</span>
                                        <p class="text-sm font-medium">Формат</p>
                                        <span class="material-symbols-outlined text-base expand-icon">expand_more</span>
                                    </button>
                                    <div id="formats" class="filter-dropdown hidden absolute mt-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-3 shadow-lg w-48">
                                        <!-- Formats will be loaded dynamically -->
                                    </div>
                                </div>

                                <!-- Price Filter -->
                                <div class="relative">
                                    <button class="filter-toggle flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark pl-3 pr-3 text-subtle-light dark:text-subtle-dark hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                                            data-target="price">
                                        <span class="material-symbols-outlined text-base">filter_list</span>
                                        <p class="text-sm font-medium">Цена</p>
                                        <span class="material-symbols-outlined text-base expand-icon">expand_more</span>
                                    </button>
                                    <div id="price" class="filter-dropdown hidden absolute mt-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 shadow-lg w-64">
                                        <div class="mb-2">
                                            <span id="price-value" class="text-sm font-medium text-text-light dark:text-text-dark">0–100 $</span>
                                        </div>
                                        <input type="range" id="price-slider" min="0" max="100" value="100"
                                               class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">
                                    </div>
                                </div>

                                <!-- Reset Filters Button -->
                                <button class="flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark px-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                                        onclick="resetFilters()">
                                    <span class="material-symbols-outlined text-subtle-light dark:text-subtle-dark text-xl">restart_alt</span>
                                    <p class="text-subtle-light dark:text-subtle-dark text-sm font-medium">Сбросить фильтры</p>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Table и остальной контент без изменений -->
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-subtle-light dark:text-subtle-dark uppercase bg-background-light dark:bg-background-dark">
                        <tr>
                            <th class="p-4" scope="col">
                                <input id="selectAll" class="h-4 w-4 rounded border-border-light dark:border-border-dark bg-transparent text-primary checked:bg-primary checked:border-primary focus:ring-2 focus:ring-offset-0 focus:ring-primary/50" type="checkbox"/>
                            </th>
                        <th class="px-4 py-3" scope="col">Обложка</th>
                        <th class="px-4 py-3 min-w-40" scope="col">Название</th>
                        <th class="px-4 py-3 min-w-40" scope="col">Автор</th>
                        <th class="px-4 py-3" scope="col">Жанр</th>
                        <th class="px-4 py-3" scope="col">Тип</th>
                        <th class="px-4 py-3" scope="col">Цена</th>
                        
                        <th class="px-4 py-3 text-right" scope="col">Действия</th>
                        </tr>
                        </thead>
                        <tbody id="booksTableBody">
                        <!-- Books will be loaded dynamically -->
                        </tbody>
                    </table>
                </div>

                <!-- Loading State -->
                <div id="loadingState" class="p-8 text-center">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
                    <p class="mt-2 text-subtle-light dark:text-subtle-dark">Загрузка книг...</p>
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="hidden p-8 text-center">
                    <span class="material-symbols-outlined text-6xl text-subtle-light dark:text-subtle-dark mb-4">menu_book</span>
                    <h3 class="text-lg font-medium text-text-light dark:text-text-dark mb-2">Книги не найдены</h3>
                    <p class="text-subtle-light dark:text-subtle-dark mb-4">Добавьте первую книгу в каталог.</p>
                    <button class="flex min-w-[84px] cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-DEFAULT h-10 px-4 bg-secondary text-secondary-content text-sm font-bold leading-normal tracking-[0.015em] hover:opacity-90" onclick="openAddBookModal()">
                        <span class="material-symbols-outlined">add</span>
                        <span class="truncate">Добавить книгу</span>
                    </button>
                </div>

                <!-- Pagination -->
                <div class="hidden flex items-center justify-between p-4 border-t border-border-light dark:border-border-dark" id="paginationContainer">
                    <span class="text-sm text-subtle-light dark:text-subtle-dark">Показано <span class="font-semibold text-text-light dark:text-text-dark" id="showingRange">1-0</span> из <span class="font-semibold text-text-light dark:text-text-dark" id="totalBooks">0</span></span>
                    <div class="flex items-center gap-2">
                        <button class="flex items-center justify-center px-3 h-8 text-sm font-medium border rounded-DEFAULT bg-content-light dark:bg-content-dark border-border-light dark:border-border-dark text-subtle-light dark:text-subtle-dark hover:bg-background-light dark:hover:bg-background-dark" onclick="previousPage()">Предыдущая</button>
                        <button class="flex items-center justify-center px-3 h-8 text-sm font-medium border rounded-DEFAULT bg-content-light dark:bg-content-dark border-border-light dark:border-border-dark text-subtle-light dark:text-subtle-dark hover:bg-background-light dark:hover:bg-background-dark" onclick="nextPage()">Следующая</button>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Add Book Modal -->
<div id="addBookModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-content-light dark:bg-content-dark rounded-lg p-6 w-full max-w-2xl mx-4">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold text-text-light dark:text-text-dark">Добавить книгу</h3>
            <button onclick="closeAddBookModal()" class="text-subtle-light dark:text-subtle-dark hover:text-text-light dark:hover:text-text-dark">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        <form id="addBookForm" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-text-light dark:text-text-dark mb-1">URL изображения обложки</label>
                    <input type="url" name="imageUrl" class="w-full rounded-DEFAULT border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark px-3 py-2 text-text-light dark:text-text-dark"
                           placeholder="https://example.com/book-cover.jpg">
                    <p class="text-xs text-subtle-light dark:text-subtle-dark mt-1">Необязательно: Укажите URL изображения обложки книги</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-text-light dark:text-text-dark mb-1">Название *</label>
                    <input type="text" name="title" required class="w-full rounded-DEFAULT border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark px-3 py-2 text-text-light dark:text-text-dark">
                </div>

                <div>
                    <label class="block text-sm font-medium text-text-light dark:text-text-dark mb-1">Автор *</label>
                    <input type="text" name="author" required class="w-full rounded-DEFAULT border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark px-3 py-2 text-text-light dark:text-text-dark">
                </div>

                <div>
                    <label class="block text-sm font-medium text-text-light dark:text-text-dark mb-1">Жанр *</label>
                    <input type="text" name="genre" required class="w-full rounded-DEFAULT border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark px-3 py-2 text-text-light dark:text-text-dark">
                </div>

                <div>
                    <label class="block text-sm font-medium text-text-light dark:text-text-dark mb-1">Цена *</label>
                    <input type="number" step="0.01" min="0" name="price" required class="w-full rounded-DEFAULT border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark px-3 py-2 text-text-light dark:text-text-dark">
                </div>

                <div>
                    <label class="block text-sm font-medium text-text-light dark:text-text-dark mb-1">Тип *</label>
                    <select name="type" required class="w-full rounded-DEFAULT border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark px-3 py-2 text-text-light dark:text-text-dark">
                        <option value="physical">Печатная</option>
                        <option value="electronic">Электронная</option>
                    </select>
                </div>

                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-text-light dark:text-text-dark mb-1">Описание</label>
                    <textarea name="description" rows="3" class="w-full rounded-DEFAULT border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark px-3 py-2 text-text-light dark:text-text-dark"
                              placeholder="Введите описание книги..."></textarea>
                </div>
            </div>

            <div class="flex justify-end gap-3 pt-4 border-t border-border-light dark:border-border-dark">
                <button type="button" onclick="closeAddBookModal()" class="px-4 py-2 text-subtle-light dark:text-subtle-dark hover:text-text-light dark:hover:text-text-dark transition-colors">Отмена</button>
                <button type="submit" class="px-4 py-2 bg-primary text-primary-content rounded-DEFAULT hover:opacity-90 transition-opacity">Добавить книгу</button>
            </div>
        </form>
    </div>
</div>

<script src="/js/api.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/admin.js"></script>
<script src="/js/admin-navigation.js"></script>
<script src="/js/admin-books.js"></script>
<script src="/js/admin-orders.js"></script>
<script src="/js/admin-customers.js"></script>
<script src="/js/admin-analytics.js"></script>
</body>
</html>
