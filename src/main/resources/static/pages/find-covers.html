<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ–±–ª–æ–∂–µ–∫ –∏ SQL</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        textarea { width: 100%; height: 200px; }
        .book-status { margin: 5px 0; }
        .found { color: green; }
        .not-found { color: red; }
    </style>
</head>
<body>

<h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ–±–ª–æ–∂–µ–∫ –∏ SQL</h1>
<button id="startBtn">–ù–∞—á–∞—Ç—å –ø–æ–∏—Å–∫</button>
<div id="progress"></div>
<div id="results"></div>

<script>
    const books = [
            {id: 1, title: "–í–æ–π–Ω–∞ –∏ –º–∏—Ä", author: "–õ–µ–≤ –¢–æ–ª—Å—Ç–æ–π"},
            {id: 2, title: "–ü—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –∏ –Ω–∞–∫–∞–∑–∞–Ω–∏–µ", author: "–§–µ–¥–æ—Ä –î–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π"},
            {id: 3, title: "1984", author: "–î–∂–æ—Ä–¥–∂ –û—Ä—É—ç–ª–ª"},
            {id: 4, title: "–£–±–∏—Ç—å –ø–µ—Ä–µ—Å–º–µ—à–Ω–∏–∫–∞", author: "–•–∞—Ä–ø–µ—Ä –õ–∏"},
            {id: 5, title: "–í–µ–ª–∏–∫–∏–π –ì—ç—Ç—Å–±–∏", author: "–§—Ä—ç–Ω—Å–∏—Å –°–∫–æ—Ç—Ç –§–∏—Ü–¥–∂–µ—Ä–∞–ª—å–¥"},
            {id: 6, title: "–í–ª–∞—Å—Ç–µ–ª–∏–Ω –ö–æ–ª–µ—Ü", author: "–î–∂. –†. –†. –¢–æ–ª–∫–∏–Ω"},
            {id: 7, title: "–ì–∞—Ä—Ä–∏ –ü–æ—Ç—Ç–µ—Ä –∏ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –∫–∞–º–µ–Ω—å", author: "–î–∂. –ö. –†–æ—É–ª–∏–Ω–≥"},
            {id: 8, title: "–ò–≥—Ä–∞ –ø—Ä–µ—Å—Ç–æ–ª–æ–≤", author: "–î–∂–æ—Ä–¥–∂ –†. –†. –ú–∞—Ä—Ç–∏–Ω"},
            {id: 9, title: "–î—é–Ω–∞", author: "–§—Ä—ç–Ω–∫ –ì–µ—Ä–±–µ—Ä—Ç"},
            {id: 10, title: "–û—Å–Ω–æ–≤–∞–Ω–∏–µ", author: "–ê–π–∑–µ–∫ –ê–∑–∏–º–æ–≤"},
            {id: 11, title: "–ù–µ–π—Ä–æ–º–∞–Ω—Ç", author: "–£–∏–ª—å—è–º –ì–∏–±—Å–æ–Ω"},
            {id: 12, title: "–ü–∏–∫–Ω–∏–∫ –Ω–∞ –æ–±–æ—á–∏–Ω–µ", author: "–ê—Ä–∫–∞–¥–∏–π –∏ –ë–æ—Ä–∏—Å –°—Ç—Ä—É–≥–∞—Ü–∫–∏–µ"},
            {id: 13, title: "–ú–∞—Ä—Å–∏–∞–Ω–∏–Ω", author: "–≠–Ω–¥–∏ –í–µ–π–µ—Ä"},
            {id: 14, title: "–î–µ—Å—è—Ç—å –Ω–µ–≥—Ä–∏—Ç—è—Ç", author: "–ê–≥–∞—Ç–∞ –ö—Ä–∏—Å—Ç–∏"},
            {id: 15, title: "–î–µ–≤—É—à–∫–∞ —Å —Ç–∞—Ç—É–∏—Ä–æ–≤–∫–æ–π –¥—Ä–∞–∫–æ–Ω–∞", author: "–°—Ç–∏–≥ –õ–∞—Ä—Å—Å–æ–Ω"},
            {id: 16, title: "–ú–æ–ª—á–∞–Ω–∏–µ —è–≥–Ω—è—Ç", author: "–¢–æ–º–∞—Å –•–∞—Ä—Ä–∏—Å"},
            {id: 17, title: "–®–µ—Ä–ª–æ–∫ –•–æ–ª–º—Å: –°–æ–±–∞–∫–∞ –ë–∞—Å–∫–µ—Ä–≤–∏–ª–µ–π", author: "–ê—Ä—Ç—É—Ä –ö–æ–Ω–∞–Ω –î–æ–π–ª"},
            {id: 18, title: "–¢—Ä–∏ —Ç–æ–≤–∞—Ä–∏—â–∞", author: "–≠—Ä–∏—Ö –ú–∞—Ä–∏—è –†–µ–º–∞—Ä–∫"},
            {id: 19, title: "–ü–æ—é—â–∏–µ –≤ —Ç–µ—Ä–Ω–æ–≤–Ω–∏–∫–µ", author: "–ö–æ–ª–∏–Ω –ú–∞–∫–∫–∞–ª–æ—É"},
            {id: 20, title: "–ù–∞–¥ –ø—Ä–æ–ø–∞—Å—Ç—å—é –≤–æ —Ä–∂–∏", author: "–î–∂–µ—Ä–æ–º –î. –°—ç–ª–∏–Ω–¥–∂–µ—Ä"},
            {id: 21, title: "–ê–Ω–Ω–∞ –ö–∞—Ä–µ–Ω–∏–Ω–∞", author: "–õ–µ–≤ –¢–æ–ª—Å—Ç–æ–π"},
            {id: 22, title: "–ì–æ—Ä–¥–æ—Å—Ç—å –∏ –ø—Ä–µ–¥—É–±–µ–∂–¥–µ–Ω–∏–µ", author: "–î–∂–µ–π–Ω –û—Å—Ç–∏–Ω"},
            {id: 23, title: "–ö—Ä–∞—Ç–∫–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤—Ä–µ–º–µ–Ω–∏", author: "–°—Ç–∏–≤–µ–Ω –•–æ–∫–∏–Ω–≥"},
            {id: 24, title: "Sapiens: –ö—Ä–∞—Ç–∫–∞—è –∏—Å—Ç–æ—Ä–∏—è —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞", author: "–Æ–≤–∞–ª—å –ù–æ–π –•–∞—Ä–∞—Ä–∏"},
            {id: 25, title: "–°–∏–ª–∞ –ø—Ä–∏–≤—ã—á–∫–∏", author: "–ß–∞—Ä–ª—å–∑ –î–∞—Ö–∏–≥–≥"},
            {id: 26, title: "–ß–µ—Ä–Ω—ã–π –ª–µ–±–µ–¥—å", author: "–ù–∞—Å—Å–∏–º –¢–∞–ª–µ–±"},
            {id: 27, title: "–ê—Ç–æ–º–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏", author: "–î–∂–µ–π–º—Å –ö–ª–∏—Ä"},
            {id: 28, title: "–ë–æ–≥–∞—Ç—ã–π –ø–∞–ø–∞, –±–µ–¥–Ω—ã–π –ø–∞–ø–∞", author: "–†–æ–±–µ—Ä—Ç –ö–∏–π–æ—Å–∞–∫–∏"},
            {id: 29, title: "7 –Ω–∞–≤—ã–∫–æ–≤ –≤—ã—Å–æ–∫–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö –ª—é–¥–µ–π", author: "–°—Ç–∏–≤–µ–Ω –ö–æ–≤–∏"},
            {id: 30, title: "–î—É–º–∞–π –∏ –±–æ–≥–∞—Ç–µ–π", author: "–ù–∞–ø–æ–ª–µ–æ–Ω –•–∏–ª–ª"},
            {id: 31, title: "–°–æ–≤–µ—Ä—à–µ–Ω–Ω—ã–π –∫–æ–¥", author: "–°—Ç–∏–≤ –ú–∞–∫–∫–æ–Ω–Ω–µ–ª–ª"},
            {id: 32, title: "–ß–∏—Å—Ç—ã–π –∫–æ–¥", author: "–†–æ–±–µ—Ä—Ç –ú–∞—Ä—Ç–∏–Ω"},
            {id: 33, title: "–ì—Ä–æ–∫–∞–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º—ã", author: "–ê–¥–∏—Ç—å—è –ë—Ö–∞—Ä–≥–∞–≤–∞"},
            {id: 34, title: "JavaScript: –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã", author: "–î—É–≥–ª–∞—Å –ö—Ä–æ–∫—Ñ–æ—Ä–¥"},
            {id: 35, title: "–ö–∞–∫ –∑–∞–≤–æ–µ–≤—ã–≤–∞—Ç—å –¥—Ä—É–∑–µ–π –∏ –æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ª—é–¥–µ–π", author: "–î–µ–π–ª –ö–∞—Ä–Ω–µ–≥–∏"},
            {id: 36, title: "–ü–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ –º–æ–∂–µ—Ç –≤—Å–µ", author: "–î–∂–æ–Ω –ö–µ—Ö–æ"},
            {id: 37, title: "–ü–æ—Ç–æ–∫", author: "–ú–∏—Ö–∞–π –ß–∏–∫—Å–µ–Ω—Ç–º–∏—Ö–∞–π–∏"},
            {id: 38, title: "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç", author: "–î—ç–Ω–∏–µ–ª –ì–æ—É–ª–º–∞–Ω"},
            {id: 39, title: "–í –¥–∏–∫–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö", author: "–î–∂–æ–Ω –ö—Ä–∞–∫–∞—É—ç—Ä"},
            {id: 40, title: "–°—Ç–∞—Ä–∏–∫ –∏ –º–æ—Ä–µ", author: "–≠—Ä–Ω–µ—Å—Ç –•–µ–º–∏–Ω–≥—É—ç–π"},
            {id: 41, title: "–û—Å—Ç—Ä–æ–≤ —Å–æ–∫—Ä–æ–≤–∏—â", author: "–†–æ–±–µ—Ä—Ç –õ—å—é–∏—Å –°—Ç–∏–≤–µ–Ω—Å–æ–Ω"},
            {id: 42, title: "–ï–≤–≥–µ–Ω–∏–π –û–Ω–µ–≥–∏–Ω", author: "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ü—É—à–∫–∏–Ω"},
            {id: 43, title: "–ö–æ–¥ –¥–∞ –í–∏–Ω—á–∏", author: "–î—ç–Ω –ë—Ä–∞—É–Ω"},
            {id: 44, title: "–ê–ª—Ö–∏–º–∏–∫", author: "–ü–∞—É–ª–æ –ö–æ—ç–ª—å–æ"},
            {id: 45, title: "–ú–µ—Ç—Ä–æ 2033", author: "–î–º–∏—Ç—Ä–∏–π –ì–ª—É—Ö–æ–≤—Å–∫–∏–π"},
            {id: 46, title: "–ü–æ—Ä—Ç—Ä–µ—Ç –î–æ—Ä–∏–∞–Ω–∞ –ì—Ä–µ—è", author: "–û—Å–∫–∞—Ä –£–∞–π–ª—å–¥"},
            {id: 47, title: "–ú–∞—Å—Ç–µ—Ä –∏ –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞", author: "–ú–∏—Ö–∞–∏–ª –ë—É–ª–≥–∞–∫–æ–≤"},
            {id: 48, title: "–°—Ç–æ –ª–µ—Ç –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–∞", author: "–ì–∞–±—Ä–∏—ç–ª—å –ì–∞—Ä—Å–∏–∞ –ú–∞—Ä–∫–µ—Å"},
            {id: 49, title: "451¬∞ –ø–æ –§–∞—Ä–µ–Ω–≥–µ–π—Ç—É", author: "–†—ç–π –ë—Ä—ç–¥–±–µ—Ä–∏"},
            {id: 50, title: "–õ–æ–ª–∏—Ç–∞", author: "–í–ª–∞–¥–∏–º–∏—Ä –ù–∞–±–æ–∫–æ–≤"},
            {id: 51, title: "–ü–∞—Ä—Ñ—é–º–µ—Ä", author: "–ü–∞—Ç—Ä–∏–∫ –ó—é—Å–∫–∏–Ω–¥"},
            {id: 52, title: "–ñ–∏–∑–Ω—å –ü–∏", author: "–Ø–Ω–Ω –ú–∞—Ä—Ç–µ–ª"}
        ];

    document.getElementById('startBtn').addEventListener('click', async () => {
        const progress = document.getElementById('progress');
        const results = document.getElementById('results');
        results.innerHTML = '';
        let sql = "INSERT INTO media (book_id, file_type, file_name, file_url) VALUES\n";
        let total = books.length;
        let count = 0;

        for (const book of books) {
            progress.textContent = `–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º ${count + 1} –∏–∑ ${total}: "${book.title}"`;
            let coverUrl = await fetchCover(book);
            const status = document.createElement('div');
            status.className = 'book-status';
            if (coverUrl) {
                status.innerHTML = `‚úÖ ${book.title} ‚Äî <a href="${coverUrl}" target="_blank">${coverUrl}</a>`;
                status.classList.add('found');
                const fileName = coverUrl.split('/').pop();
                sql += `(${book.id}, 'image', '${fileName}', '${coverUrl}'),\n`;
            } else {
                status.innerHTML = `‚ùå ${book.title} ‚Äî –æ–±–ª–æ–∂–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`;
                status.classList.add('not-found');
            }
            results.appendChild(status);
            count++;
            await new Promise(r => setTimeout(r, 500)); // –ø–ª–∞–≤–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å
        }

        sql = sql.slice(0, -2) + ';'; // —É–±–∏—Ä–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–ø—è—Ç—É—é
        const sqlSection = document.createElement('div');
        sqlSection.innerHTML = `
            <h3>üìã SQL –∫–æ–¥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</h3>
            <textarea readonly>${sql}</textarea>
            <p><strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong></p>
            <ol>
                <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ SQL –∫–æ–¥ –≤—ã—à–µ</li>
                <li>–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ –≤–∞—à–µ–π MySQL –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</li>
                <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ: <code>SELECT * FROM media;</code></li>
            </ol>
        `;
        results.appendChild(sqlSection);
        progress.textContent = '–ì–æ—Ç–æ–≤–æ!';
    });

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –æ–±–ª–æ–∂–∫–∏ —á–µ—Ä–µ–∑ OpenLibrary + Google Books
    async function fetchCover(book) {
        try {
            // OpenLibrary –ø–æ–∏—Å–∫
            let resp = await fetch(`https://openlibrary.org/search.json?title=${encodeURIComponent(book.title)}&author=${encodeURIComponent(book.author)}`);
            let data = await resp.json();
            if (data.docs && data.docs.length > 0 && data.docs[0].cover_i) {
                return `https://covers.openlibrary.org/b/id/${data.docs[0].cover_i}-L.jpg`;
            }

            // Google Books –ø–æ–∏—Å–∫
            resp = await fetch(`https://www.googleapis.com/books/v1/volumes?q=intitle:${encodeURIComponent(book.title)}+inauthor:${encodeURIComponent(book.author)}`);
            data = await resp.json();
            if (data.items && data.items[0].volumeInfo.imageLinks) {
                return data.items[0].volumeInfo.imageLinks.thumbnail.replace('http://','https://');
            }
        } catch (e) {
            console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –æ–±–ª–æ–∂–∫–∏ –¥–ª—è', book.title, e);
        }
        return null;
    }
</script>

</body>
</html>
